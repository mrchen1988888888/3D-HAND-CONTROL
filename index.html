<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dr. Strange: Server Select</title>
    <style>
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; background-color: #000; font-family: monospace; }
        
        #input-video { 
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; 
            z-index: 1; transform: scaleX(-1); object-fit: cover; opacity: 0.5;
        }

        /* Server Selection UI */
        #server-select {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            z-index: 999; background: rgba(0,0,0,0.9); padding: 20px; border-radius: 10px;
            border: 1px solid #00ff88; text-align: center; width: 80%;
        }
        
        .server-btn {
            display: block; width: 100%; padding: 15px; margin: 10px 0;
            background: #222; color: white; border: 1px solid #555;
            font-size: 16px; cursor: pointer; border-radius: 5px;
        }
        .server-btn:active { background: #00ff88; color: black; }

        #status-log {
            position: absolute; bottom: 20px; width: 100%; text-align: center;
            color: #00ff88; font-size: 14px; z-index: 50; background: rgba(0,0,0,0.7); padding: 5px;
        }

        /* The Tracker Dot */
        #finger-dot {
            position: absolute; width: 30px; height: 30px; 
            background: red; border: 3px solid white; 
            border-radius: 50%; z-index: 100; 
            transform: translate(-50%, -50%); display: none;
            box-shadow: 0 0 20px red;
        }
    </style>
</head>
<body>

    <video id="input-video" playsinline></video>
    
    <!-- TRACKER DOT -->
    <div id="finger-dot"></div>

    <div id="status-log">WAITING FOR SERVER SELECTION...</div>

    <!-- SERVER SELECTOR -->
    <div id="server-select">
        <h2 style="color:white; margin-top:0;">SELECT AI SERVER</h2>
        <p style="color:#aaa; font-size:12px;">If one hangs, refresh and try another.</p>
        
        <button class="server-btn" onclick="loadAI('google')">
            SERVER A: Google (VPN Required)
        </button>
        
        <button class="server-btn" onclick="loadAI('jsdelivr')">
            SERVER B: jsDelivr (Global)
        </button>
        
        <button class="server-btn" onclick="loadAI('unpkg')">
            SERVER C: Unpkg (Backup)
        </button>
    </div>

    <!-- Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/control_utils/control_utils.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>

    <script>
        const statusLog = document.getElementById('status-log');
        const selector = document.getElementById('server-select');
        const dot = document.getElementById('finger-dot');
        let hands;
        let camera;

        async function loadAI(source) {
            // Hide menu
            selector.style.display = 'none';
            statusLog.innerText = `CONNECTING TO ${source.toUpperCase()}...`;

            let baseUrl = "";
            
            // Define Server Paths
            if(source === 'google') {
                // Official Google Source
                baseUrl = `https://cdn.jsdelivr.net/npm/@mediapipe/hands/`; 
            } else if (source === 'jsdelivr') {
                // Fast Global CDN
                baseUrl = `https://cdn.jsdelivr.net/npm/@mediapipe/hands@0.4.1646424915/`;
            } else if (source === 'unpkg') {
                // Backup CDN
                baseUrl = `https://unpkg.com/@mediapipe/hands@0.4.1646424915/`;
            }

            try {
                hands = new Hands({locateFile: (file) => {
                    statusLog.innerText = `DOWNLOADING: ${file}`;
                    return `${baseUrl}${file}`;
                }});

                hands.setOptions({
                    maxNumHands: 1,
                    modelComplexity: 0, // Lite mode (Faster download)
                    minDetectionConfidence: 0.5,
                    minTrackingConfidence: 0.5
                });

                hands.onResults(onResults);

                // Start Camera
                const videoElement = document.getElementById('input-video');
                camera = new Camera(videoElement, {
                    onFrame: async () => {
                        await hands.send({image: videoElement});
                    },
                    width: 640, height: 480, facingMode: 'user'
                });

                await camera.start();
                statusLog.innerText = "CAMERA ACTIVE. WAITING FOR HAND...";

            } catch (e) {
                statusLog.innerText = "ERROR: " + e.message;
                alert("Failed to load. Refresh and try a different server.");
            }
        }

        function onResults(results) {
            // If we get here, AI is working!
            
            if (results.multiHandLandmarks.length > 0) {
                const lm = results.multiHandLandmarks[0];
                const tip = lm[8]; // Index Finger

                // Show Dot
                dot.style.display = 'block';
                
                // Map coordinates
                const x = (1 - tip.x) * window.innerWidth;
                const y = tip.y * window.innerHeight;

                dot.style.left = x + "px";
                dot.style.top = y + "px";

                statusLog.innerText = "SYSTEM ONLINE - TRACKING ACTIVE";
                statusLog.style.color = "#00ff88";
            } else {
                dot.style.display = 'none';
                statusLog.innerText = "NO HAND DETECTED";
                statusLog.style.color = "yellow";
            }
        }
    </script>
</body>
</html>
